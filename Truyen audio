package com.long.truyenaudio

import android.os.Bundle
import android.widget.TextView
import androidx.appcompat.app.AppCompatActivity
import java.io.BufferedReader
import java.io.InputStreamReader
import java.net.HttpURLConnection
import java.net.URL
import kotlin.concurrent.thread

class MainActivity : AppCompatActivity() {

    private lateinit var textView: TextView

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        textView = findViewById(R.id.textView)
        textView.text = "Đang tải truyện..."

        loadStoryFromWeb()
    }

    private fun loadStoryFromWeb() {
        thread {
            try {
                val url = URL("https://jsonplaceholder.typicode.com/posts/1")
                val conn = url.openConnection() as HttpURLConnection
                conn.requestMethod = "GET"
                conn.connectTimeout = 15000
                conn.readTimeout = 15000

                val reader = BufferedReader(InputStreamReader(conn.inputStream))
                val result = reader.readText()
                reader.close()
                conn.disconnect()

                runOnUiThread {
                    textView.text = result
                }
            } catch (e: Exception) {
                runOnUiThread {
                    textView.text = "Lỗi: ${e.message}"
                }
            }
        }
    }
}
